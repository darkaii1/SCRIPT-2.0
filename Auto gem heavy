getgenv().KillAura = true
getgenv().Range = 100
getgenv().AttackSpeed = 0.15

local player = game.Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")
local playerGui = player:WaitForChild("PlayerGui")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local Workspace = game:GetService("Workspace")

local targets = {["Cultist"]=true,["Crossbow Cultist"]=true,["Juggernaut Cultist"]=true}
local weaponDPS={["Katana"]=15,["Good Axe"]=9,["Old Axe"]=7}

local blGui = Instance.new("ScreenGui", playerGui)
blGui.Name = "FarmingMessageGui"
local messageLabel = Instance.new("TextLabel", blGui)
messageLabel.Size = UDim2.new(0,300,0,40)
messageLabel.Position = UDim2.new(0,10,1,-50)
messageLabel.BackgroundTransparency=0.5
messageLabel.BackgroundColor3 = Color3.fromRGB(0,0,0)
messageLabel.TextColor3 = Color3.fromRGB(255,255,0)
messageLabel.Font = Enum.Font.SourceSansBold
messageLabel.TextSize = 20
messageLabel.Text = "Waiting for HumanoidRootPart..."

local function updateMessage(msg,color)
    messageLabel.Text = msg
    if color then messageLabel.TextColor3 = color end
end

repeat
    hrp = char:FindFirstChild("HumanoidRootPart")
    if not hrp then
        updateMessage("Waiting for HumanoidRootPart...",Color3.fromRGB(255,255,0))
        wait(0.5)
    end
until hrp

updateMessage("STARTING FARM!",Color3.fromRGB(0,255,0))

local topGui = Instance.new("ScreenGui", playerGui)
topGui.Name="TopDarkaiiGui"
local letters = "Darkaii"
local fonts = {Enum.Font.Gotham,Enum.Font.GothamBold,Enum.Font.Antique,Enum.Font.ArialBold,Enum.Font.SourceSansBold,Enum.Font.Fantasy}
local letterLabels={}
local startX,startY,spacing=500,20,40
for i=1,#letters do
    local letter=Instance.new("TextLabel")
    letter.Size=UDim2.new(0,36,0,36)
    letter.Position=UDim2.new(0,startX+(i-1)*spacing,0,startY)
    letter.BackgroundTransparency=1
    letter.TextColor3=Color3.fromRGB(255,255,255)
    letter.Font=fonts[math.random(1,#fonts)]
    letter.TextSize=36
    letter.Text=letters:sub(i,i)
    letter.Parent=topGui
    table.insert(letterLabels,letter)
end

spawn(function()
    local t=0
    while true do
        for i,lbl in ipairs(letterLabels) do
            lbl.Position=UDim2.new(0,startX+(i-1)*spacing,0,startY+math.sin(t+i*0.5)*10)
        end
        t=t+0.1
        wait(0.03)
    end
end)

local function getStrongestWeaponAndRemote()
    local bestTool,bestDamage,bestRemote=nil,0,nil
    local function checkTool(tool)
        local dmg=weaponDPS[tool.Name] or 0
        if tool:FindFirstChild("Damage") then dmg=tonumber(tool.Damage.Value) or dmg end
        if tool:FindFirstChild("Stats") and tool.Stats:FindFirstChild("Damage") then dmg=tonumber(tool.Stats.Damage.Value) or dmg end
        if tool:GetAttribute("Damage") then dmg=tonumber(tool:GetAttribute("Damage")) or dmg end
        if dmg>bestDamage then bestDamage,bestTool=dmg,tool end
    end
    for _,tool in ipairs(player.Backpack:GetChildren()) do if tool:IsA("Tool") then checkTool(tool) end end
    for _,tool in ipairs(char:GetChildren()) do if tool:IsA("Tool") then checkTool(tool) end end
    if bestTool then
        for _,v in ipairs(bestTool:GetDescendants()) do
            if v:IsA("RemoteEvent") or v:IsA("RemoteFunction") then bestRemote=v; break end
        end
    end
    return bestTool,bestRemote
end

local function fireRemote(remote,npc)
    local hum=npc:FindFirstChild("Humanoid")
    if not hum then return end
    pcall(function() remote:FireServer(npc) end)
    pcall(function() remote:FireServer("Attack",npc) end)
    pcall(function() remote:FireServer("Hit",npc) end)
    pcall(function() remote:FireServer(npc,hum) end)
    pcall(function() remote:FireServer({Target=npc}) end)
end

local function multiHitAttack()
    local _,remote=getStrongestWeaponAndRemote()
    if not remote then return end
    for _,npc in ipairs(Workspace:GetDescendants()) do
        if npc:FindFirstChild("Humanoid") and npc:FindFirstChild("HumanoidRootPart") then
            if targets[npc.Name] and npc.Humanoid.Health>0 then
                local dist=(npc.HumanoidRootPart.Position-hrp.Position).Magnitude
                if dist<=getgenv().Range then fireRemote(remote,npc) end
            end
        end
    end
end

local function findAllChests()
    local chests={}
    for _,v in ipairs(Workspace:GetDescendants()) do
        if v:FindFirstChildWhichIsA("ProximityPrompt") and v.Name=="Chest" then
            table.insert(chests,v)
        end
    end
    return chests
end

local function findDiamondChest()
    for _,v in ipairs(Workspace:GetDescendants()) do
        if v.Name=="Diamond Chest" and v:FindFirstChildWhichIsA("ProximityPrompt") then
            return v
        end
    end
end

local function teleportAbove(position,height)
    char:SetPrimaryPartCFrame(CFrame.new(position+Vector3.new(0,height,0)))
end

local function autoOpenChest(chest)
    if not chest then return false end
    local prompt=chest:FindFirstChildWhichIsA("ProximityPrompt")
    if prompt and prompt.Enabled then
        prompt:InputHoldBegin()
        prompt:InputHoldEnd()
        local hasDiamond=chest:FindFirstChild("Diamond")~=nil
        return hasDiamond
    end
    return false
end

local function openAllChestsAndCollectDiamonds()
    local chests=findAllChests()
    for _,chest in ipairs(chests) do
        local droppedDiamond=autoOpenChest(chest)
        if droppedDiamond then
            teleportAbove(chest.Position,3)
            wait(0.2)
        end
    end
end

local function findStronghold()
    for _,v in ipairs(Workspace:GetDescendants()) do
        if v.Name=="Stronghold" then return v end
    end
end

local function startStrongholdWave(stronghold)
    if not stronghold then return end
    local pos=stronghold.PrimaryPart and stronghold.PrimaryPart.Position or stronghold.Position
    teleportAbove(pos,5)
    wait(0.5)
end

local function serverHop()
    local placeId = game.PlaceId
    local visited = {}
    while true do
        local success, servers = pcall(function()
            return HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/"..placeId.."/servers/Public?sortOrder=Asc&limit=100")).data
        end)
        if success and type(servers)=="table" then
            for _,s in pairs(servers) do
                if tonumber(s.playing)<tonumber(s.maxPlayers) and s.id~=game.JobId and not visited[s.id] then
                    visited[s.id]=true
                    TeleportService:TeleportToPlaceInstance(placeId,s.id,player)
                    return
                end
            end
        end
        wait(1)
    end
end

spawn(function()
    while true do
        if not char or char.Humanoid.Health <= 0 then
            pcall(function()
                serverHop()
            end)
            break
        end
        wait(0.1)
    end
end)

spawn(function()
    while true do
        openAllChestsAndCollectDiamonds()
        local diamondChest=findDiamondChest()
        if diamondChest then
            teleportAbove(diamondChest.Position,3)
            local stronghold=findStronghold()
            if stronghold then
                startStrongholdWave(stronghold)
                local waveOngoing=false
                while not waveOngoing do
                    for _,npc in ipairs(Workspace:GetDescendants()) do
                        if targets[npc.Name] and npc:FindFirstChild("Humanoid") and npc.Humanoid.Health>0 then
                            waveOngoing=true
                            break
                        end
                    end
                    wait(0.1)
                end
                while true do
                    if getgenv().KillAura then multiHitAttack() end
                    wait(getgenv().AttackSpeed)
                    local cleared=true
                    for _,npc in ipairs(Workspace:GetDescendants()) do
                        if targets[npc.Name] and npc:FindFirstChild("Humanoid") and npc.Humanoid.Health>0 then
                            cleared=false
                            break
                        end
                    end
                    if cleared then break end
                end
            end
        end
        wait(10)
        serverHop()
        break
    end
end)
